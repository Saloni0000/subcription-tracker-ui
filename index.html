<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Subscription Tracker</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-brand">
            <i class="fas fa-credit-card"></i>
            <span>SubTracker</span>
        </div>
        <div class="nav-links">
            <a href="#" id="dashboardBtn" class="nav-link active">Dashboard</a>
            <a href="#" id="profileBtn" class="nav-link">Profile</a>
            <a href="#" id="logoutBtn" class="nav-link">Logout</a>
        </div>
    </nav>

    <!-- Auth Container -->
    <div id="authContainer" class="container">
        <!-- Login Form -->
        <div id="loginForm" class="auth-form">
            <div class="form-card">
                <h2><i class="fas fa-sign-in-alt"></i> Sign In</h2>
                <form id="loginFormElement">
                    <div class="form-group">
                        <label for="loginEmail">Email</label>
                        <input type="email" id="loginEmail" required>
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">Password</label>
                        <input type="password" id="loginPassword" required>
                    </div>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-sign-in-alt"></i> Sign In
                    </button>
                </form>
                <p class="auth-switch">
                    Don't have an account? <a href="#" id="showRegister">Sign Up</a>
                </p>
            </div>
        </div>

        <!-- Register Form -->
        <div id="registerForm" class="auth-form hidden">
            <div class="form-card">
                <h2><i class="fas fa-user-plus"></i> Sign Up</h2>
                <form id="registerFormElement">
                    <div class="form-group">
                        <label for="registerName">Name</label>
                        <input type="text" id="registerName" required>
                    </div>
                    <div class="form-group">
                        <label for="registerEmail">Email</label>
                        <input type="email" id="registerEmail" required>
                    </div>
                    <div class="form-group">
                        <label for="registerPassword">Password</label>
                        <input type="password" id="registerPassword" required>
                    </div>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-user-plus"></i> Sign Up
                    </button>
                </form>
                <p class="auth-switch">
                    Already have an account? <a href="#" id="showLogin">Sign In</a>
                </p>
            </div>
        </div>
    </div>

    <!-- Main App Container -->
    <div id="appContainer" class="container hidden">
        <!-- Dashboard -->
        <div id="dashboard" class="section active">
            <div class="dashboard-header">
                <h1>My Subscriptions</h1>
                <button id="addSubscriptionBtn" class="btn btn-primary">
                    <i class="fas fa-plus"></i> Add Subscription
                </button>
            </div>

            <!-- Stats Cards -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-credit-card"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="totalSubscriptions">0</h3>
                        <p>Total Subscriptions</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-dollar-sign"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="monthlySpend">$0</h3>
                        <p>Monthly Spend</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="yearlySpend">$0</h3>
                        <p>Yearly Spend</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-play"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="activeSubscriptions">0</h3>
                        <p>Active</p>
                    </div>
                </div>
            </div>

            <!-- Subscriptions List -->
            <div class="subscriptions-container">
                <div class="subscriptions-header">
                    <h2>Your Subscriptions</h2>
                    <div class="filter-controls">
                        <select id="statusFilter">
                            <option value="">All Status</option>
                            <option value="active">Active</option>
                            <option value="inactive">Inactive</option>
                            <option value="cancelled">Cancelled</option>
                        </select>
                        <select id="categoryFilter">
                            <option value="">All Categories</option>
                            <option value="entertainment">Entertainment</option>
                            <option value="utilities">Utilities</option>
                            <option value="food">Food</option>
                            <option value="health">Health</option>
                            <option value="education">Education</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                </div>
                <div id="subscriptionsList" class="subscriptions-list">
                    <!-- Subscriptions will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Profile Section -->
        <div id="profile" class="section">
            <div class="profile-header">
                <h1>Profile Settings</h1>
            </div>
            <div class="profile-card">
                <form id="profileForm">
                    <div class="form-group">
                        <label for="profileName">Name</label>
                        <input type="text" id="profileName" required>
                    </div>
                    <div class="form-group">
                        <label for="profileEmail">Email</label>
                        <input type="email" id="profileEmail" required>
                    </div>
                    <div class="form-group">
                        <label for="currentPassword">Current Password</label>
                        <input type="password" id="currentPassword" placeholder="Enter current password to change profile">
                    </div>
                    <div class="form-group">
                        <label for="newPassword">New Password (optional)</label>
                        <input type="password" id="newPassword" placeholder="Leave blank to keep current password">
                    </div>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Update Profile
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Add/Edit Subscription Modal -->
    <div id="subscriptionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Add Subscription</h2>
                <span class="close">&times;</span>
            </div>
            <form id="subscriptionForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="subName">Name</label>
                        <input type="text" id="subName" required>
                    </div>
                    <div class="form-group">
                        <label for="subPrice">Price</label>
                        <input type="number" id="subPrice" step="0.01" min="0" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="subCurrency">Currency</label>
                        <select id="subCurrency" required>
                            <option value="USD">USD</option>
                            <option value="EUR">EUR</option>
                            <option value="GBP">GBP</option>
                            <option value="INR">INR</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="subFrequency">Frequency</label>
                        <select id="subFrequency" required>
                            <option value="monthly">Monthly</option>
                            <option value="yearly">Yearly</option>
                            <option value="weekly">Weekly</option>
                            <option value="daily">Daily</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="subCategory">Category</label>
                        <select id="subCategory" required>
                            <option value="entertainment">Entertainment</option>
                            <option value="utilities">Utilities</option>
                            <option value="food">Food</option>
                            <option value="health">Health</option>
                            <option value="education">Education</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="subPaymentMethod">Payment Method</label>
                        <input type="text" id="subPaymentMethod" required placeholder="e.g., Credit Card, PayPal">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="subStartDate">Start Date</label>
                        <input type="date" id="subStartDate" required>
                    </div>
                    <div class="form-group">
                        <label for="subStatus">Status</label>
                        <select id="subStatus">
                            <option value="active">Active</option>
                            <option value="inactive">Inactive</option>
                            <option value="cancelled">Cancelled</option>
                        </select>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="cancelModal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Subscription</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay hidden">
        <div class="spinner"></div>
    </div>

    <!-- Toast Notifications -->
    <div id="toastContainer" class="toast-container"></div>

    <style>
/* Reset and Base Styles */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    line-height: 1.6;
    color: #333;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
}

.container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

/* Utility Classes */
.hidden {
    display: none !important;
}

.text-center {
    text-align: center;
}

.mb-1 { margin-bottom: 0.5rem; }
.mb-2 { margin-bottom: 1rem; }
.mb-3 { margin-bottom: 1.5rem; }

/* Navigation */
.navbar {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    padding: 1rem 2rem;
    box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
    position: sticky;
    top: 0;
    z-index: 100;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.nav-brand {
    display: flex;
    align-items: center;
    font-size: 1.5rem;
    font-weight: bold;
    color: #667eea;
}

.nav-brand i {
    margin-right: 0.5rem;
    font-size: 1.8rem;
}

.nav-links {
    display: flex;
    gap: 2rem;
}

.nav-link {
    text-decoration: none;
    color: #666;
    font-weight: 500;
    padding: 0.5rem 1rem;
    border-radius: 8px;
    transition: all 0.3s ease;
}

.nav-link:hover,
.nav-link.active {
    color: #667eea;
    background: rgba(102, 126, 234, 0.1);
}

/* Auth Forms */
.auth-form {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: calc(100vh - 80px);
}

.form-card {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    padding: 2.5rem;
    border-radius: 20px;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
    width: 100%;
    max-width: 400px;
    animation: slideUp 0.5s ease;
}

@keyframes slideUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.form-card h2 {
    text-align: center;
    margin-bottom: 2rem;
    color: #333;
    font-size: 1.8rem;
}

.form-card h2 i {
    margin-right: 0.5rem;
    color: #667eea;
}

/* Form Elements */
.form-group {
    margin-bottom: 1.5rem;
}

.form-row {
    display: flex;
    gap: 1rem;
}

.form-row .form-group {
    flex: 1;
}

.form-group label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 500;
    color: #555;
}

.form-group input,
.form-group select {
    width: 100%;
    padding: 0.8rem 1rem;
    border: 2px solid #e0e0e0;
    border-radius: 10px;
    font-size: 1rem;
    transition: all 0.3s ease;
    background: rgba(255, 255, 255, 0.9);
}

.form-group input:focus,
.form-group select:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

/* Buttons */
.btn {
    padding: 0.8rem 1.5rem;
    border: none;
    border-radius: 10px;
    font-size: 1rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s ease;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    justify-content: center;
}

.btn-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
}

.btn-secondary {
    background: #f8f9fa;
    color: #666;
    border: 2px solid #e0e0e0;
}

.btn-secondary:hover {
    background: #e9ecef;
    border-color: #ccc;
}

.btn-danger {
    background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
    color: white;
}

.btn-danger:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(255, 107, 107, 0.3);
}

.btn:full-width {
    width: 100%;
}

/* Auth Switch */
.auth-switch {
    text-align: center;
    margin-top: 1.5rem;
    color: #666;
}

.auth-switch a {
    color: #667eea;
    text-decoration: none;
    font-weight: 500;
}

.auth-switch a:hover {
    text-decoration: underline;
}

/* Dashboard */
.dashboard-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
}

.dashboard-header h1 {
    color: white;
    font-size: 2.5rem;
    font-weight: 300;
}

/* Stats Grid */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.stat-card {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    padding: 2rem;
    border-radius: 20px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    display: flex;
    align-items: center;
    gap: 1.5rem;
    transition: transform 0.3s ease;
}

.stat-card:hover {
    transform: translateY(-5px);
}

.stat-icon {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1.5rem;
}

.stat-content h3 {
    font-size: 2rem;
    margin-bottom: 0.5rem;
    color: #333;
}

.stat-content p {
    color: #666;
    font-weight: 500;
}

/* Subscriptions Container */
.subscriptions-container {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-radius: 20px;
    padding: 2rem;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
}

.subscriptions-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
}

.subscriptions-header h2 {
    color: #333;
    font-size: 1.5rem;
}

.filter-controls {
    display: flex;
    gap: 1rem;
}

.filter-controls select {
    padding: 0.5rem 1rem;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    background: white;
}

/* Subscriptions List */
.subscriptions-list {
    display: grid;
    gap: 1rem;
}

.subscription-card {
    background: white;
    border-radius: 15px;
    padding: 1.5rem;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
    transition: all 0.3s ease;
    border-left: 4px solid #667eea;
}

.subscription-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.12);
}

.subscription-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 1rem;
}

.subscription-info h3 {
    color: #333;
    margin-bottom: 0.5rem;
    font-size: 1.2rem;
}

.subscription-price {
    font-size: 1.5rem;
    font-weight: bold;
    color: #667eea;
}

.subscription-details {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 1rem;
    margin-bottom: 1rem;
}

.detail-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: #666;
    font-size: 0.9rem;
}

.detail-item i {
    color: #667eea;
    width: 16px;
}

.subscription-actions {
    display: flex;
    gap: 0.5rem;
    justify-content: flex-end;
}

.btn-small {
    padding: 0.4rem 0.8rem;
    font-size: 0.8rem;
}

/* Status Badges */
.status-badge {
    padding: 0.3rem 0.8rem;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.status-active {
    background: rgba(40, 167, 69, 0.1);
    color: #28a745;
}

.status-inactive {
    background: rgba(255, 193, 7, 0.1);
    color: #ffc107;
}

.status-cancelled {
    background: rgba(220, 53, 69, 0.1);
    color: #dc3545;
}

/* Modal */
.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(5px);
}

.modal-content {
    background: white;
    margin: 5% auto;
    padding: 0;
    border-radius: 20px;
    width: 90%;
    max-width: 600px;
    max-height: 90vh;
    overflow-y: auto;
    animation: modalSlide 0.3s ease;
}

@keyframes modalSlide {
    from {
        opacity: 0;
        transform: translateY(-50px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 2rem;
    border-bottom: 1px solid #e0e0e0;
}

.modal-header h2 {
    margin: 0;
    color: #333;
}

.close {
    font-size: 2rem;
    font-weight: bold;
    cursor: pointer;
    color: #999;
    transition: color 0.3s ease;
}

.close:hover {
    color: #333;
}

.modal form {
    padding: 2rem;
}

.form-actions {
    display: flex;
    gap: 1rem;
    justify-content: flex-end;
    margin-top: 2rem;
    padding-top: 1rem;
    border-top: 1px solid #e0e0e0;
}

/* Profile */
.profile-header {
    margin-bottom: 2rem;
}

.profile-header h1 {
    color: white;
    font-size: 2.5rem;
    font-weight: 300;
}

.profile-card {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-radius: 20px;
    padding: 2rem;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
    max-width: 600px;
}

/* Loading Overlay */
.loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(5px);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 2000;
}

.spinner {
    width: 50px;
    height: 50px;
    border: 4px solid #f3f3f3;
    border-top: 4px solid #667eea;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Toast Notifications */
.toast-container {
    position: fixed;
    top: 100px;
    right: 20px;
    z-index: 1500;
}

.toast {
    background: white;
    padding: 1rem 1.5rem;
    border-radius: 10px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    margin-bottom: 1rem;
    max-width: 400px;
    animation: toastSlide 0.3s ease;
    display: flex;
    align-items: center;
    gap: 1rem;
    border-left: 4px solid #667eea;
}

.toast.success {
    border-left-color: #28a745;
}

.toast.error {
    border-left-color: #dc3545;
}

.toast.warning {
    border-left-color: #ffc107;
}

@keyframes toastSlide {
    from {
        opacity: 0;
        transform: translateX(100px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

/* Sections */
.section {
    display: none;
}

.section.active {
    display: block;
}

/* Responsive Design */
@media (max-width: 768px) {
    .navbar {
        padding: 1rem;
    }
    
    .nav-links {
        gap: 1rem;
    }
    
    .dashboard-header {
        flex-direction: column;
        gap: 1rem;
        align-items: flex-start;
    }
    
    .dashboard-header h1 {
        font-size: 2rem;
    }
    
    .stats-grid {
        grid-template-columns: 1fr;
    }
    
    .subscriptions-header {
        flex-direction: column;
        gap: 1rem;
        align-items: flex-start;
    }
    
    .filter-controls {
        width: 100%;
        justify-content: space-between;
    }
    
    .form-row {
        flex-direction: column;
    }
    
    .subscription-details {
        grid-template-columns: 1fr;
    }
    
    .subscription-actions {
        flex-wrap: wrap;
    }
    
    .modal-content {
        margin: 10% auto;
        width: 95%;
    }
}

@media (max-width: 480px) {
    .container {
        padding: 10px;
    }
    
    .form-card {
        padding: 1.5rem;
    }
    
    .modal-header,
    .modal form {
        padding: 1.5rem;
    }
    
    .stat-card {
        padding: 1.5rem;
    }
    
    .subscriptions-container {
        padding: 1.5rem;
    }
}
    </style>

    <script>
// config.js
const API_CONFIG = {
    BASE_URL: 'https://subcription-tracker-backend-1.onrender.com/api/v1',
    ENDPOINTS: {
        AUTH: {
            SIGNUP: '/auth/sign-up',
            SIGNIN: '/auth/sign-in',
            SIGNOUT: '/auth/sign-out'
        },
        USERS: {
            BASE: '/users',
            GET_USER: (id) => `/users/${id}`,
            UPDATE_USER: (id) => `/users/${id}`,
            DELETE_USER: (id) => `/users/${id}`
        },
        SUBSCRIPTIONS: {
            BASE: '/subscriptions',
            CREATE: '/subscriptions',
            GET_USER_SUBS: (userId) => `/subscriptions/user/${userId}`,
            UPDATE: (id) => `/subscriptions/${id}`,
            DELETE: (id) => `/subscriptions/${id}`,
            CANCEL: (id) => `/subscriptions/${id}/cancel`
        }
    }
};

// utils.js
class Utils {
    static showLoading() {
        document.getElementById('loadingOverlay').classList.remove('hidden');
    }

    static hideLoading() {
        document.getElementById('loadingOverlay').classList.add('hidden');
    }

    static showToast(message, type = 'info') {
        const toastContainer = document.getElementById('toastContainer');
        const toast = document.createElement('div');
        toast.className = `toast ${type}`;
        
        const iconMap = {
            success: 'fas fa-check-circle',
            error: 'fas fa-exclamation-circle',
            warning: 'fas fa-exclamation-triangle',
            info: 'fas fa-info-circle'
        };
        
        toast.innerHTML = `
            <i class="${iconMap[type] || iconMap.info}"></i>
            <span>${message}</span>
        `;
        
        toastContainer.appendChild(toast);
        
        setTimeout(() => {
            toast.style.animation = 'toastSlide 0.3s ease reverse';
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.parentNode.removeChild(toast);
                }
            }, 300);
        }, 4000);
    }

    static formatCurrency(amount, currency = 'USD') {
        return new Intl.NumberFormat('en-US', {
            style: 'currency',
            currency: currency
        }).format(amount);
    }

    static formatDate(date) {
        return new Date(date).toLocaleDateString('en-US', {
            year: 'numeric',
            month: 'short',
            day: 'numeric'
        });
    }

    static calculateNextRenewal(startDate, frequency) {
        const start = new Date(startDate);
        const now = new Date();
        let next = new Date(start);

        const periods = {
            daily: 1,
            weekly: 7,
            monthly: 30,
            yearly: 365
        };
        
        const days = periods[frequency] || 30;
        
        while (next <= now) {
            next.setDate(next.getDate() + days);
        }
        
        return next;
    }

    static getDaysUntilRenewal(renewalDate) {
        const now = new Date();
        const renewal = new Date(renewalDate);
        const diffTime = renewal.getTime() - now.getTime();
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        return Math.max(0, diffDays);
    }

    static validateEmail(email) {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return emailRegex.test(email);
    }

    static validatePassword(password) {
        return password && password.length >= 6;
    }

    static clearForm(formId) {
        const form = document.getElementById(formId);
        if (form) {
            form.reset();
        }
    }

    static setFormData(formId, data) {
        const form = document.getElementById(formId);
        if (!form) return;

        Object.keys(data).forEach(key => {
            const field = form.querySelector(`#${key}`) || form.querySelector(`[name="${key}"]`);
            if (field) {
                if (field.type === 'date' && data[key]) {
                    field.value = new Date(data[key]).toISOString().split('T')[0];
                } else {
                    field.value = data[key] || '';
                }
            }
        });
    }

    static getFormData(formId) {
        const form = document.getElementById(formId);
        if (!form) return {};

        const formData = new FormData(form);
        const data = {};
        
        for (let [key, value] of formData.entries()) {
            data[key] = value;
        }

        // Also get data from elements with IDs
        const inputs = form.querySelectorAll('input, select, textarea');
        inputs.forEach(input => {
            if (input.id) {
                const key = input.id.replace(/^(sub|profile|register|login)/, '').toLowerCase();
                if (key) {
                    data[key] = input.value;
                }
            }
        });

        return data;
    }
}

// api.js
class API {
    static getAuthHeaders() {
        const token = localStorage.getItem('token');
        return {
            'Content-Type': 'application/json',
            ...(token && { 'Authorization': `Bearer ${token}` })
        };
    }

    static async makeRequest(url, options = {}) {
        const fullUrl = `${API_CONFIG.BASE_URL}${url}`;
        
        const defaultOptions = {
            headers: this.getAuthHeaders(),
            ...options
        };

        // Add timeout to fetch request
        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), 10000); // 10 second timeout

        try {
            const response = await fetch(fullUrl, {
                ...defaultOptions,
                signal: controller.signal
            });
            
            clearTimeout(timeoutId);
            const data = await response.json();

            if (!response.ok) {
                throw new Error(data.message || `HTTP error! status: ${response.status}`);
            }

            return data;
        } catch (error) {
            clearTimeout(timeoutId);
            if (error.name === 'AbortError') {
                throw new Error('Request timeout');
            }
            console.error('API request failed:', error);
            throw error;
        }
    }

    // Auth API calls
    static async signup(userData) {
        return this.makeRequest(API_CONFIG.ENDPOINTS.AUTH.SIGNUP, {
            method: 'POST',
            body: JSON.stringify(userData)
        });
    }

    static async signin(credentials) {
        return this.makeRequest(API_CONFIG.ENDPOINTS.AUTH.SIGNIN, {
            method: 'POST',
            body: JSON.stringify(credentials)
        });
    }

    static async signout() {
        return this.makeRequest(API_CONFIG.ENDPOINTS.AUTH.SIGNOUT, {
            method: 'POST'
        });
    }

    // User API calls
    static async getUser(userId) {
        return this.makeRequest(API_CONFIG.ENDPOINTS.USERS.GET_USER(userId));
    }

    static async updateUser(userId, userData) {
        return this.makeRequest(API_CONFIG.ENDPOINTS.USERS.UPDATE_USER(userId), {
            method: 'PUT',
            body: JSON.stringify(userData)
        });
    }

    static async deleteUser(userId, password) {
        return this.makeRequest(API_CONFIG.ENDPOINTS.USERS.DELETE_USER(userId), {
            method: 'DELETE',
            body: JSON.stringify({ password })
        });
    }

    // Subscription API calls
    static async createSubscription(subscriptionData) {
        return this.makeRequest(API_CONFIG.ENDPOINTS.SUBSCRIPTIONS.CREATE, {
            method: 'POST',
            body: JSON.stringify(subscriptionData)
        });
    }

    static async getUserSubscriptions(userId) {
        return this.makeRequest(API_CONFIG.ENDPOINTS.SUBSCRIPTIONS.GET_USER_SUBS(userId));
    }

    static async updateSubscription(subscriptionId, subscriptionData) {
        return this.makeRequest(API_CONFIG.ENDPOINTS.SUBSCRIPTIONS.UPDATE(subscriptionId), {
            method: 'PUT',
            body: JSON.stringify(subscriptionData)
        });
    }

    static async deleteSubscription(subscriptionId) {
        return this.makeRequest(API_CONFIG.ENDPOINTS.SUBSCRIPTIONS.DELETE(subscriptionId), {
            method: 'DELETE'
        });
    }

    static async cancelSubscription(subscriptionId, reason) {
        return this.makeRequest(API_CONFIG.ENDPOINTS.SUBSCRIPTIONS.CANCEL(subscriptionId), {
            method: 'PUT',
            body: JSON.stringify({ reason })
        });
    }
}

// auth.js
class Auth {
    static init() {
        this.bindEvents();
        this.checkAuthState();
    }

    static bindEvents() {
        // Form submissions
        document.getElementById('loginFormElement').addEventListener('submit', this.handleLogin.bind(this));
        document.getElementById('registerFormElement').addEventListener('submit', this.handleRegister.bind(this));
        
        // Form switching
        document.getElementById('showRegister').addEventListener('click', this.showRegisterForm.bind(this));
        document.getElementById('showLogin').addEventListener('click', this.showLoginForm.bind(this));
        
        // Logout
        document.getElementById('logoutBtn').addEventListener('click', this.handleLogout.bind(this));
    }

    static async handleLogin(e) {
        e.preventDefault();
        
        const email = document.getElementById('loginEmail').value;
        const password = document.getElementById('loginPassword').value;

        if (!Utils.validateEmail(email)) {
            Utils.showToast('Please enter a valid email address', 'error');
            return;
        }

        if (!Utils.validatePassword(password)) {
            Utils.showToast('Password must be at least 6 characters long', 'error');
            return;
        }

        try {
            Utils.showLoading();
            const response = await API.signin({ email, password });
            
            if (response.success) {
                localStorage.setItem('token', response.data.token);
                localStorage.setItem('user', JSON.stringify(response.data.user));
                
                Utils.showToast('Login successful!', 'success');
                this.showApp();
                Dashboard.init();
            }
        } catch (error) {
            Utils.showToast(error.message || 'Login failed', 'error');
        } finally {
            Utils.hideLoading();
        }
    }

    static async handleRegister(e) {
        e.preventDefault();
        
        const name = document.getElementById('registerName').value.trim();
        const email = document.getElementById('registerEmail').value;
        const password = document.getElementById('registerPassword').value;

        if (!name || name.length < 2) {
            Utils.showToast('Name must be at least 2 characters long', 'error');
            return;
        }

        if (!Utils.validateEmail(email)) {
            Utils.showToast('Please enter a valid email address', 'error');
            return;
        }

        if (!Utils.validatePassword(password)) {
            Utils.showToast('Password must be at least 6 characters long', 'error');
            return;
        }

        try {
            Utils.showLoading();
            const response = await API.signup({ name, email, password });
            
            if (response.success) {
                localStorage.setItem('token', response.data.token);
                localStorage.setItem('user', JSON.stringify(response.data.user));
                
                Utils.showToast('Registration successful!', 'success');
                this.showApp();
                Dashboard.init();
            }
        } catch (error) {
            Utils.showToast(error.message || 'Registration failed', 'error');
        } finally {
            Utils.hideLoading();
        }
    }

    // FIXED LOGOUT FUNCTION
    static async handleLogout() {
        // Immediately disable the logout button to prevent multiple clicks
        const logoutBtn = document.getElementById('logoutBtn');
        const originalText = logoutBtn.innerHTML;
        logoutBtn.style.pointerEvents = 'none';
        logoutBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Logging out...';
        
        try {
            Utils.showLoading(); // Show spinner immediately
            
            // Set a timeout for the API call to prevent hanging
            const logoutPromise = API.signout();
            const timeoutPromise = new Promise((_, reject) => 
                setTimeout(() => reject(new Error('Logout timeout')), 5000)
            );
            
            try {
                await Promise.race([logoutPromise, timeoutPromise]);
            } catch (error) {
                console.error('Logout API error:', error);
                // Continue with local logout even if API fails
            }
            
        } catch (error) {
            console.error('Logout error:', error);
        } finally {
            // Always clear local storage and redirect, regardless of API response
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            Utils.hideLoading(); // Hide spinner
            
            // Re-enable button (though it will be hidden soon)
            logoutBtn.style.pointerEvents = 'auto';
            logoutBtn.innerHTML = originalText;
            
            this.showAuth();
            Utils.showToast('Logged out successfully', 'info');
        }
    }

    static showRegisterForm(e) {
        e.preventDefault();
        document.getElementById('loginForm').classList.add('hidden');
        document.getElementById('registerForm').classList.remove('hidden');
    }

    static showLoginForm(e) {
        e.preventDefault();
        document.getElementById('registerForm').classList.add('hidden');
        document.getElementById('loginForm').classList.remove('hidden');
    }

    // IMPROVED SHOWAUTH FUNCTION
    static showAuth() {
        // Hide app immediately
        document.getElementById('appContainer').classList.add('hidden');
        document.querySelector('.navbar').style.display = 'none';
        
        // Show auth with a slight delay for smooth transition
        setTimeout(() => {
            document.getElementById('authContainer').classList.remove('hidden');
            // Clear any form data
            document.getElementById('loginFormElement').reset();
            document.getElementById('registerFormElement').reset();
            // Ensure login form is shown
            document.getElementById('registerForm').classList.add('hidden');
            document.getElementById('loginForm').classList.remove('hidden');
        }, 100);
    }

    static showApp() {
        document.getElementById('authContainer').classList.add('hidden');
        document.getElementById('appContainer').classList.remove('hidden');
        document.querySelector('.navbar').style.display = 'flex';
    }

    static checkAuthState() {
        const token = localStorage.getItem('token');
        if (token) {
            this.showApp();
            Dashboard.init();
        } else {
            this.showAuth();
        }
    }

    static getCurrentUser() {
        const userStr = localStorage.getItem('user');
        return userStr ? JSON.parse(userStr) : null;
    }

    static isAuthenticated() {
        return !!localStorage.getItem('token');
    }
}

// dashboard.js
class Dashboard {
    static subscriptions = [];
    static filteredSubscriptions = [];

    static init() {
        this.bindEvents();
        this.loadSubscriptions();
    }

    static bindEvents() {
        // Navigation
        document.getElementById('dashboardBtn').addEventListener('click', this.showDashboard.bind(this));
        document.getElementById('profileBtn').addEventListener('click', this.showProfile.bind(this));
        
        // Filters
        document.getElementById('statusFilter').addEventListener('change', this.filterSubscriptions.bind(this));
        document.getElementById('categoryFilter').addEventListener('change', this.filterSubscriptions.bind(this));
    }

    static showDashboard(e) {
        e.preventDefault();
        document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
        e.target.classList.add('active');
        
        document.querySelectorAll('.section').forEach(section => section.classList.remove('active'));
        document.getElementById('dashboard').classList.add('active');
        
        this.loadSubscriptions();
    }

    static showProfile(e) {
        e.preventDefault();
        document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
        e.target.classList.add('active');
        
        document.querySelectorAll('.section').forEach(section => section.classList.remove('active'));
        document.getElementById('profile').classList.add('active');
        
        Profile.init();
    }

    static async loadSubscriptions() {
        const user = Auth.getCurrentUser();
        if (!user) return;

        try {
            Utils.showLoading();
            const response = await API.getUserSubscriptions(user._id);
            
            if (response.success) {
                this.subscriptions = response.data;
                this.filteredSubscriptions = [...this.subscriptions];
                this.renderSubscriptions();
                this.updateStats();
            }
        } catch (error) {
            Utils.showToast('Failed to load subscriptions', 'error');
            console.error('Load subscriptions error:', error);
        } finally {
            Utils.hideLoading();
        }
    }

    static renderSubscriptions() {
        const container = document.getElementById('subscriptionsList');
        
        if (this.filteredSubscriptions.length === 0) {
            container.innerHTML = `
                <div class="text-center" style="padding: 3rem; color: #666;">
                    <i class="fas fa-inbox" style="font-size: 3rem; margin-bottom: 1rem; color: #ddd;"></i>
                    <h3>No subscriptions found</h3>
                    <p>Add your first subscription to get started!</p>
                </div>
            `;
            return;
        }

        container.innerHTML = this.filteredSubscriptions.map(sub => this.createSubscriptionCard(sub)).join('');
        
        // Bind action buttons
        this.bindSubscriptionActions();
    }

    static createSubscriptionCard(subscription) {
        const nextRenewal = Utils.calculateNextRenewal(subscription.startDate, subscription.frequency);
        const daysUntil = Utils.getDaysUntilRenewal(nextRenewal);
        
        return `
            <div class="subscription-card">
                <div class="subscription-header">
                    <div class="subscription-info">
                        <h3>${subscription.name}</h3>
                        <span class="status-badge status-${subscription.status}">${subscription.status}</span>
                    </div>
                    <div class="subscription-price">
                        ${Utils.formatCurrency(subscription.price, subscription.currency)}
                        <div style="font-size: 0.8rem; color: #666; font-weight: normal;">
                            /${subscription.frequency}
                        </div>
                    </div>
                </div>
                
                <div class="subscription-details">
                    <div class="detail-item">
                        <i class="fas fa-tag"></i>
                        <span>${subscription.category}</span>
                    </div>
                    <div class="detail-item">
                        <i class="fas fa-credit-card"></i>
                        <span>${subscription.paymentMethod}</span>
                    </div>
                    <div class="detail-item">
                        <i class="fas fa-calendar-alt"></i>
                        <span>Started: ${Utils.formatDate(subscription.startDate)}</span>
                    </div>
                    <div class="detail-item">
                        <i class="fas fa-clock"></i>
                        <span>Next: ${daysUntil} days (${Utils.formatDate(nextRenewal)})</span>
                    </div>
                </div>
                
                <div class="subscription-actions">
                    <button class="btn btn-secondary btn-small edit-btn" data-id="${subscription._id}">
                        <i class="fas fa-edit"></i> Edit
                    </button>
                    ${subscription.status === 'active' ? `
                        <button class="btn btn-danger btn-small cancel-btn" data-id="${subscription._id}">
                            <i class="fas fa-pause"></i> Cancel
                        </button>
                    ` : ''}
                    <button class="btn btn-danger btn-small delete-btn" data-id="${subscription._id}">
                        <i class="fas fa-trash"></i> Delete
                    </button>
                </div>
            </div>
        `;
    }

    static bindSubscriptionActions() {
        // Edit buttons
        document.querySelectorAll('.edit-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const subscriptionId = e.target.closest('.edit-btn').dataset.id;
                const subscription = this.subscriptions.find(s => s._id === subscriptionId);
                if (subscription) {
                    SubscriptionManager.openEditModal(subscription);
                }
            });
        });

        // Cancel buttons
        document.querySelectorAll('.cancel-btn').forEach(btn => {
            btn.addEventListener('click', async (e) => {
                const subscriptionId = e.target.closest('.cancel-btn').dataset.id;
                if (confirm('Are you sure you want to cancel this subscription?')) {
                    await this.cancelSubscription(subscriptionId);
                }
            });
        });

        // Delete buttons
        document.querySelectorAll('.delete-btn').forEach(btn => {
            btn.addEventListener('click', async (e) => {
                const subscriptionId = e.target.closest('.delete-btn').dataset.id;
                if (confirm('Are you sure you want to delete this subscription? This action cannot be undone.')) {
                    await this.deleteSubscription(subscriptionId);
                }
            });
        });
    }

    static async cancelSubscription(subscriptionId) {
        try {
            Utils.showLoading();
            const response = await API.cancelSubscription(subscriptionId, 'User requested cancellation');
            
            if (response.success) {
                Utils.showToast('Subscription cancelled successfully', 'success');
                this.loadSubscriptions();
            }
        } catch (error) {
            Utils.showToast('Failed to cancel subscription', 'error');
            console.error('Cancel subscription error:', error);
        } finally {
            Utils.hideLoading();
        }
    }

    static async deleteSubscription(subscriptionId) {
        try {
            Utils.showLoading();
            const response = await API.deleteSubscription(subscriptionId);
            
            if (response.success) {
                Utils.showToast('Subscription deleted successfully', 'success');
                this.loadSubscriptions();
            }
        } catch (error) {
            Utils.showToast('Failed to delete subscription', 'error');
            console.error('Delete subscription error:', error);
        } finally {
            Utils.hideLoading();
        }
    }

    static filterSubscriptions() {
        const statusFilter = document.getElementById('statusFilter').value;
        const categoryFilter = document.getElementById('categoryFilter').value;

        this.filteredSubscriptions = this.subscriptions.filter(sub => {
            const statusMatch = !statusFilter || sub.status === statusFilter;
            const categoryMatch = !categoryFilter || sub.category === categoryFilter;
            return statusMatch && categoryMatch;
        });

        this.renderSubscriptions();
        this.updateStats();
    }

    static updateStats() {
        const subs = this.filteredSubscriptions;
        const activeSubs = subs.filter(s => s.status === 'active');
        
        // Calculate monthly spend
        let monthlySpend = 0;
        activeSubs.forEach(sub => {
            switch(sub.frequency) {
                case 'daily':
                    monthlySpend += sub.price * 30;
                    break;
                case 'weekly':
                    monthlySpend += sub.price * 4.33;
                    break;
                case 'monthly':
                    monthlySpend += sub.price;
                    break;
                case 'yearly':
                    monthlySpend += sub.price / 12;
                    break;
            }
        });

        document.getElementById('totalSubscriptions').textContent = subs.length;
        document.getElementById('activeSubscriptions').textContent = activeSubs.length;
        document.getElementById('monthlySpend').textContent = Utils.formatCurrency(monthlySpend);
        document.getElementById('yearlySpend').textContent = Utils.formatCurrency(monthlySpend * 12);
    }
}

// profile.js
class Profile {
    static init() {
        this.loadUserData();
        this.bindEvents();
    }

    static bindEvents() {
        document.getElementById('profileForm').addEventListener('submit', this.handleUpdateProfile.bind(this));
    }

    static loadUserData() {
        const user = Auth.getCurrentUser();
        if (!user) return;

        document.getElementById('profileName').value = user.name || '';
        document.getElementById('profileEmail').value = user.email || '';
    }

    static async handleUpdateProfile(e) {
        e.preventDefault();
        
        const user = Auth.getCurrentUser();
        if (!user) return;

        const name = document.getElementById('profileName').value.trim();
        const email = document.getElementById('profileEmail').value.trim();
        const currentPassword = document.getElementById('currentPassword').value;
        const newPassword = document.getElementById('newPassword').value;

        if (!name || name.length < 2) {
            Utils.showToast('Name must be at least 2 characters long', 'error');
            return;
        }

        if (!Utils.validateEmail(email)) {
            Utils.showToast('Please enter a valid email address', 'error');
            return;
        }

        if (!currentPassword) {
            Utils.showToast('Current password is required to update profile', 'error');
            return;
        }

        if (newPassword && !Utils.validatePassword(newPassword)) {
            Utils.showToast('New password must be at least 6 characters long', 'error');
            return;
        }

        const updateData = {
            name,
            email,
            currentPassword
        };

        if (newPassword) {
            updateData.password = newPassword;
        }

        try {
            Utils.showLoading();
            const response = await API.updateUser(user._id, updateData);
            
            if (response.success) {
                // Update stored user data
                localStorage.setItem('user', JSON.stringify(response.data));
                
                Utils.showToast('Profile updated successfully', 'success');
                
                // Clear password fields
                document.getElementById('currentPassword').value = '';
                document.getElementById('newPassword').value = '';
            }
        } catch (error) {
            Utils.showToast(error.message || 'Failed to update profile', 'error');
        } finally {
            Utils.hideLoading();
        }
    }
}

// subscriptions.js
class SubscriptionManager {
    static currentEditingId = null;

    static init() {
        this.bindEvents();
    }

    static bindEvents() {
        // Add subscription button
        document.getElementById('addSubscriptionBtn').addEventListener('click', this.openAddModal.bind(this));
        
        // Modal events
        document.querySelector('.close').addEventListener('click', this.closeModal.bind(this));
        document.getElementById('cancelModal').addEventListener('click', this.closeModal.bind(this));
        document.getElementById('subscriptionForm').addEventListener('submit', this.handleSubmit.bind(this));
        
        // Close modal on outside click
        document.getElementById('subscriptionModal').addEventListener('click', (e) => {
            if (e.target === document.getElementById('subscriptionModal')) {
                this.closeModal();
            }
        });
    }

    static openAddModal() {
        this.currentEditingId = null;
        document.getElementById('modalTitle').textContent = 'Add Subscription';
        Utils.clearForm('subscriptionForm');
        
        // Set default values
        document.getElementById('subCurrency').value = 'USD';
        document.getElementById('subFrequency').value = 'monthly';
        document.getElementById('subStatus').value = 'active';
        document.getElementById('subStartDate').value = new Date().toISOString().split('T')[0];
        
        this.showModal();
    }

    static openEditModal(subscription) {
        this.currentEditingId = subscription._id;
        document.getElementById('modalTitle').textContent = 'Edit Subscription';
        
        // Map subscription data to form fields
        const formData = {
            subName: subscription.name,
            subPrice: subscription.price,
            subCurrency: subscription.currency,
            subFrequency: subscription.frequency,
            subCategory: subscription.category,
            subPaymentMethod: subscription.paymentMethod,
            subStatus: subscription.status,
            subStartDate: subscription.startDate
        };
        
        Utils.setFormData('subscriptionForm', formData);
        this.showModal();
    }

    static showModal() {
        document.getElementById('subscriptionModal').style.display = 'block';
        document.body.style.overflow = 'hidden';
    }

    static closeModal() {
        document.getElementById('subscriptionModal').style.display = 'none';
        document.body.style.overflow = 'auto';
        this.currentEditingId = null;
        Utils.clearForm('subscriptionForm');
    }

    static async handleSubmit(e) {
        e.preventDefault();
        
        const formData = {
            name: document.getElementById('subName').value.trim(),
            price: parseFloat(document.getElementById('subPrice').value),
            currency: document.getElementById('subCurrency').value,
            frequency: document.getElementById('subFrequency').value,
            category: document.getElementById('subCategory').value,
            paymentMethod: document.getElementById('subPaymentMethod').value.trim(),
            status: document.getElementById('subStatus').value,
            startDate: document.getElementById('subStartDate').value
        };

        // Validation
        if (!formData.name || formData.name.length < 2) {
            Utils.showToast('Subscription name must be at least 2 characters', 'error');
            return;
        }

        if (!formData.price || formData.price < 0) {
            Utils.showToast('Price must be a positive number', 'error');
            return;
        }

        if (!formData.paymentMethod) {
            Utils.showToast('Payment method is required', 'error');
            return;
        }

        if (!formData.startDate) {
            Utils.showToast('Start date is required', 'error');
            return;
        }

        // Check if start date is not in the future
        const startDate = new Date(formData.startDate);
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        
        if (startDate > today) {
            Utils.showToast('Start date cannot be in the future', 'error');
            return;
        }

        try {
            Utils.showLoading();
            let response;

            if (this.currentEditingId) {
                response = await API.updateSubscription(this.currentEditingId, formData);
                Utils.showToast('Subscription updated successfully', 'success');
            } else {
                response = await API.createSubscription(formData);
                Utils.showToast('Subscription created successfully', 'success');
            }

            if (response.success) {
                this.closeModal();
                Dashboard.loadSubscriptions();
            }
        } catch (error) {
            Utils.showToast(error.message || 'Failed to save subscription', 'error');
        } finally {
            Utils.hideLoading();
        }
    }
}

// app.js
class App {
    static init() {
        this.initializeComponents();
    }

    static initializeComponents() {
        Auth.init();
        SubscriptionManager.init();
    }
}

// Initialize the app when DOM is loaded
document.addEventListener('DOMContentLoaded', () => {
    App.init();
});
    </script>
</body>
</html>
